<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Play minecraft 1.8 in your browser" />
    <meta name="keywords" content="eaglercraft, eaglercraftx, minecraft, 1.8, 1.8.8" />
    <title>EaglercraftX 1.8</title>
    <meta property="og:locale" content="en-US" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="EaglercraftX 1.8" />
    <meta property="og:description" content="Play minecraft 1.8 in your browser" />
    <meta property="og:image" content="favicon.png" />
    <link type="image/png" rel="shortcut icon" href="favicon.png" />
    <script type="text/javascript" src="classes.js"></script>
    <script type="text/javascript" src="fix-webm-duration.js"></script>
    <script type="text/javascript">
      "use strict";
      window.addEventListener("load", () => {
        if (document.location.href.startsWith("file:")) {
          alert("HTTP please, do not open this file locally, run a local HTTP server and load it via HTTP!");
        } else {
          // %%%%%%%%% launch options %%%%%%%%%%%%
          window.eaglercraftXOpts = {
            container: "game_frame",
            assetsURI: "assets.epk",
            localesURI: "lang/",
            servers: [
              /* example: { addr: "ws://localhost:8081/", name: "Local test server" } */
            ]
          };
          // %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

          var q = window.location.search;
          if (typeof q === "string" && q.startsWith("?")) {
            q = new URLSearchParams(q);
            var s = q.get("server");
            if (s) window.eaglercraftXOpts.joinServer = s;
          }

          main();

          // --- Debug UI Implementation ---

          // Create "Debug info" button (always visible, fixed to top-right)
          var debugBtn = document.createElement("button");
          debugBtn.id = "debug-btn";
          debugBtn.textContent = "Debug info";
          debugBtn.style.position = "fixed";
          debugBtn.style.top = "10px";
          debugBtn.style.right = "10px";
          debugBtn.style.zIndex = "10001";
          document.body.appendChild(debugBtn);

          // Create debug panel (hidden by default)
          var debugPanel = document.createElement("div");
          debugPanel.id = "debug-panel";
          debugPanel.style.position = "fixed";
          debugPanel.style.top = "50px";
          debugPanel.style.right = "10px";
          debugPanel.style.width = "300px";
          debugPanel.style.maxHeight = "400px";
          debugPanel.style.background = "white";
          debugPanel.style.color = "black";
          debugPanel.style.border = "1px solid black";
          debugPanel.style.overflowY = "auto";
          debugPanel.style.display = "none";
          debugPanel.style.zIndex = "10000";
          debugPanel.style.fontFamily = "monospace";
          document.body.appendChild(debugPanel);

          // Header area inside the debug panel with a title and the Advanced Debug toggle.
          var header = document.createElement("div");
          header.style.padding = "5px";
          header.style.background = "#eee";
          header.style.borderBottom = "1px solid black";
          header.style.display = "flex";
          header.style.justifyContent = "space-between";
          header.style.alignItems = "center";
          var headerSpan = document.createElement("span");
          headerSpan.textContent = "Debug Log";
          header.appendChild(headerSpan);
          var advancedToggle = document.createElement("button");
          advancedToggle.id = "advanced-toggle";
          advancedToggle.textContent = "Enable Advanced Debug";
          advancedToggle.style.fontSize = "12px";
          header.appendChild(advancedToggle);
          debugPanel.appendChild(header);

          // Container for displaying the debug messages.
          var debugMessages = document.createElement("div");
          debugMessages.id = "debug-messages";
          debugMessages.style.padding = "5px";
          debugMessages.style.whiteSpace = "pre-wrap";
          debugMessages.style.fontSize = "12px";
          debugPanel.appendChild(debugMessages);

          // Button to download the logs (only visible in advanced mode)
          var downloadBtn = document.createElement("button");
          downloadBtn.id = "download-log";
          downloadBtn.textContent = "Download Debug Log";
          downloadBtn.style.display = "none";
          downloadBtn.style.margin = "5px";
          downloadBtn.style.fontSize = "12px";
          debugPanel.appendChild(downloadBtn);

          // Toggle display of the debug panel when the Debug info button is clicked.
          debugBtn.addEventListener("click", () => {
            debugPanel.style.display = debugPanel.style.display === "none" ? "block" : "none";
          });

          // Toggle advanced debug mode â€” when enabled, show the Download button.
          var advancedDebugEnabled = false;
          advancedToggle.addEventListener("click", () => {
            advancedDebugEnabled = !advancedDebugEnabled;
            downloadBtn.style.display = advancedDebugEnabled ? "inline-block" : "none";
            advancedToggle.textContent = advancedDebugEnabled ? "Disable Advanced Debug" : "Enable Advanced Debug";
          });

          // When the download button is pressed, compile and download the debug log as a text file.
          downloadBtn.addEventListener("click", () => {
            var logs = window._debugLogArray.join("\n");
            var blob = new Blob([logs], { type: "text/plain;charset=utf-8" });
            var url = URL.createObjectURL(blob);
            var a = document.createElement("a");
            a.href = url;
            a.download = "debug-log.txt";
            a.click();
            URL.revokeObjectURL(url);
          });

          // --- Redirect Console Output to the Debug Log ---

          // Create an array to store the log messages.
          window._debugLogArray = [];

          // Save original console methods.
          const originalLog = console.log;
          const originalError = console.error;
          const originalWarn = console.warn;

          // Helper function to append messages to our debug area.
          function appendDebugMessage(message) {
            window._debugLogArray.push(message);
            debugMessages.textContent += message + "\n";
            // Ensure the latest messages are visible.
            debugMessages.scrollTop = debugMessages.scrollHeight;
          }

          // Override console.log, console.error, and console.warn.
          console.log = function(...args) {
            originalLog.apply(console, args);
            appendDebugMessage("[LOG] " + args.join(" "));
          };

          console.error = function(...args) {
            originalError.apply(console, args);
            appendDebugMessage("[ERROR] " + args.join(" "));
          };

          console.warn = function(...args) {
            originalWarn.apply(console, args);
            appendDebugMessage("[WARN] " + args.join(" "));
          };
        }
      });
    </script>
  </head>
  <body style="margin:0px;width:100vw;height:100vh;overflow:hidden;" id="game_frame">
    <!-- The game canvas (or iframe) is rendered here -->
  </body>
</html>
